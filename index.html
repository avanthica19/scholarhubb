<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholar Hub - Local Demo</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load React, ReactDOM, and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Configure Tailwind for custom colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'teal-500': '#14B8A6',
                        'teal-600': '#0D9488',
                        'teal-700': '#0F766E',
                    }
                }
            }
        }
    </script>
    <!-- Use Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

</head>
<body class="bg-gray-50 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- MOCK DATA (Replaces Firestore) ---
        const MOCK_USER_ID = 'STU-12345';
        const MOCK_USERNAME = 'DemoStudent_123';

        const MOCK_BOOKS = [
            { id: 'b1', title: 'Introduction to Algorithms', author: 'Cormen et al.', photoURL: 'https://placehold.co/400x160/F0F4F8/607C9A?text=Algo+Book', department: 'Computer Science', subject: 'Algorithms', year: '2nd Year', price: 850, type: 'Buy', sellerId: 'SELLER-98765', sellerUsername: 'CS_Senior' },
            { id: 'b2', title: 'Linear Circuit Theory', author: 'Nilsen', photoURL: 'https://placehold.co/400x160/F0F4F8/607C9A?text=Circuits', department: 'Electrical Engineering', subject: 'Circuit Theory', year: '1st Year', price: 400, type: 'Rent', sellerId: 'SELLER-98765', sellerUsername: 'EE_Power' },
            { id: 'b3', title: 'The Great Gatsby', author: 'F. Scott Fitzgerald', photoURL: 'https://placehold.co/400x160/F0F4F8/607C9A?text=Gatsby', department: 'Humanities', subject: 'Literature', year: '1st Year', price: 0, type: 'Free', sellerId: MOCK_USER_ID, sellerUsername: MOCK_USERNAME },
            { id: 'b4', title: 'Marketing Management', author: 'Kotler & Keller', photoURL: 'https://placehold.co/400x160/F0F4F8/607C9A?text=Marketing', department: 'Business', subject: 'Marketing', year: '3rd Year', price: 1200, type: 'Buy', sellerId: 'SELLER-00112', sellerUsername: 'MBA_Tutor' },
            { id: 'b5', title: 'Cell Biology Essentials', author: 'Lodish', photoURL: 'https://placehold.co/400x160/F0F4F8/607C9A?text=Biology+101', department: 'Biology', subject: 'Cell Biology', year: '2nd Year', price: 300, type: 'Rent', sellerId: 'SELLER-98765', sellerUsername: 'Bio_Enthusiast' },
        ];
        
        // --- Department and Subject Structure ---
        const DEPARTMENT_SUBJECTS = {
            'Computer Science': ['Data Structures', 'Algorithms', 'Operating Systems', 'Networking'],
            'Electrical Engineering': ['Circuit Theory', 'Digital Logic', 'Signals and Systems', 'Electromagnetics'],
            'Humanities': ['World History', 'Literature', 'Philosophy', 'Art History'],
            'Business': ['Microeconomics', 'Finance', 'Marketing', 'Accounting'],
            'Biology': ['Genetics', 'Cell Biology', 'Ecology', 'Anatomy'],
        };
        const DEPARTMENTS = Object.keys(DEPARTMENT_SUBJECTS);
        const YEARS = ['1st Year', '2nd Year', '3rd Year', '4th Year'];
        const LISTING_TYPES = ['Buy', 'Rent', 'Free']; 

        // Custom Modal Component for simple messages (replacing alert/confirm)
        const Modal = ({ isOpen, title, message, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex justify-center items-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 transform transition-all scale-100">
                        <h3 className="text-xl font-bold text-teal-700 mb-3">{title}</h3>
                        <p className="text-gray-700 mb-6">{message}</p>
                        <div className="flex justify-end space-x-3">
                            <button
                                onClick={onClose}
                                className='w-full bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600 transition duration-150 font-semibold'
                            >
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Main Application Component
        const App = () => {
            // --- State Management ---
            // Simplified Auth/Registration for Demo
            const [userId, setUserId] = useState(MOCK_USER_ID);
            const [username, setUsername] = useState(MOCK_USERNAME); 
            const [isAuthenticated, setIsAuthenticated] = useState(true);
            const [isRegistered, setIsRegistered] = useState(true); 
            
            const [currentPage, setCurrentPage] = useState('Home'); 
            const [selectedBookId, setSelectedBookId] = useState(null);
            const [books, setBooks] = useState(MOCK_BOOKS); // Local state for mock books
            const [filter, setFilter] = useState({ department: 'All', subject: 'All', year: 'All', type: 'All' });
            const [modal, setModal] = useState({ isOpen: false, title: '', message: '' });
            const [isLoading, setIsLoading] = useState(false); // No loading for local mock

            // --- Core Data/Action Functions (Mocked) ---
            
            const handleSignOut = () => {
                // Mock sign out
                setUserId('GUEST_USER');
                setUsername('Guest');
                setIsAuthenticated(false);
                setIsRegistered(false);
                setCurrentPage('Home');
                setModal({ isOpen: true, title: "Demo Action", message: "Sign Out is simulated. User state reset." });
            };
            
            const initiateChatForBook = (book) => {
                if (!isRegistered) {
                    setModal({ isOpen: true, title: "Demo Action", message: "In a real app, you would need to register first." });
                    return;
                }

                if (book.sellerId === userId) {
                    setModal({ isOpen: true, title: "Demo Action", message: "You cannot chat about your own listing." });
                    return;
                }
                
                // Mock navigation to a chat
                setModal({ 
                    isOpen: true, 
                    title: "Demo Chat Initiated", 
                    message: `A chat has been initiated with ${book.sellerUsername} regarding "${book.title}". In the live application, this would open the real-time chat interface.` 
                });
                setCurrentPage('Messages');
            };

            const addBook = (bookData) => {
                if (!isRegistered) {
                    setModal({ isOpen: true, title: "Demo Action", message: "Please sign in/register to list a book." });
                    return;
                }

                // Mock book addition with a new ID
                const newBook = {
                    ...bookData,
                    id: 'b' + Date.now(),
                    sellerId: userId,
                    sellerUsername: username,
                    timestamp: new Date(), // Use JS Date for local mock
                    price: parseFloat(bookData.price || 0),
                };
                
                setBooks(prev => [newBook, ...prev]);
                setCurrentPage('Home');
                setModal({ isOpen: true, title: "Success!", message: `Your book listing for "${bookData.title}" has been added (Local Demo Only).` });
            };
            
            const deleteBook = (bookId, bookTitle) => {
                // Mock deletion logic (since we removed the confirmation modal complexity)
                setBooks(prev => prev.filter(b => b.id !== bookId));
                setModal({ isOpen: true, title: "Deleted!", message: `The listing for "${bookTitle}" has been successfully removed (Local Demo Only).` });
                setCurrentPage('Profile'); 
                setSelectedBookId(null);
            };


            // --- Filtered Book Data ---
            const filteredBooks = useMemo(() => {
                let currentBooks = books;

                // Apply page-specific type filter
                if (currentPage === 'Buy' || currentPage === 'Rent' || currentPage === 'Free') {
                    currentBooks = currentBooks.filter(book => book.type === currentPage);
                }

                // Apply general filters
                if (filter.department !== 'All') {
                    currentBooks = currentBooks.filter(book => book.department === filter.department);
                }
                if (filter.subject !== 'All') {
                    currentBooks = currentBooks.filter(book => book.subject === filter.subject);
                }
                if (filter.year !== 'All') {
                    currentBooks = currentBooks.filter(book => book.year === filter.year);
                }
                if (filter.type !== 'All' && currentPage === 'Home') { 
                    currentBooks = currentBooks.filter(book => book.type === filter.type);
                }

                return currentBooks;
            }, [books, filter, currentPage]);

            // --- UI Components ---

            const getBadgeColor = (type) => {
                switch (type) {
                    case 'Buy': return 'bg-teal-200 text-teal-800';
                    case 'Rent': return 'bg-indigo-200 text-indigo-800';
                    case 'Free': return 'bg-green-200 text-green-800';
                    default: return 'bg-gray-200 text-gray-800';
                }
            };

            const NavBar = () => (
                <nav className="flex items-center justify-between p-4 bg-white shadow-md sticky top-0 z-10">
                    <h1 className="text-2xl font-extrabold text-teal-600 tracking-wider cursor-pointer" onClick={() => setCurrentPage('Home')}>
                        Scholar Hub
                    </h1>
                    <div className="flex space-x-4">
                        {['Home', 'Sell', 'Messages', 'Profile'].map(page => {
                            const isAttentionPage = page !== 'Home' && !isRegistered;
                            return (
                                <button
                                    key={page}
                                    onClick={() => {
                                        // Mock: Go to profile if registration needed, otherwise navigate
                                        if (!isRegistered && page !== 'Home') {
                                            setModal({ isOpen: true, title: "Demo Action", message: "Please Register first in a live app." });
                                            setCurrentPage('Profile');
                                        } else {
                                            setCurrentPage(page);
                                            setSelectedBookId(null); 
                                        }
                                    }}
                                    className={`px-3 py-1 rounded-lg transition-colors duration-150 font-semibold relative ${
                                        currentPage === page ? 'bg-teal-500 text-white shadow-md' : 'text-teal-600 hover:bg-teal-100'
                                    }`}
                                >
                                    {page}
                                    {isAttentionPage && (
                                        <span className="absolute top-0 right-0 block h-2 w-2 transform translate-x-1 -translate-y-1 rounded-full ring-2 ring-white bg-red-500"></span>
                                    )}
                                </button>
                            );
                        })}
                        <button
                            onClick={handleSignOut}
                            className="px-3 py-1 rounded-lg text-white bg-gray-500 hover:bg-gray-600 transition duration-150 font-semibold"
                        >
                            {isAuthenticated ? 'Sign Out' : 'Sign In (Demo)'}
                        </button>
                    </div>
                </nav>
            );

            const BookCard = ({ book }) => {
                const isFree = book.type === 'Free';
                const priceDisplay = isFree ? 'Free' : (book.type === 'Rent' ? `₹${book.price.toFixed(0)}/Sem` : `₹${book.price.toFixed(0)}`);
                const isOwner = book.sellerId === userId;

                return (
                    <div className="bg-white rounded-xl shadow-lg border-t-4 border-teal-400 hover:shadow-xl transition-shadow duration-300 overflow-hidden">
                        
                        <div className="h-40 w-full bg-gray-100 flex items-center justify-center border-b border-gray-200">
                            <img 
                                src={book.photoURL} 
                                alt={book.title} 
                                className="w-full h-full object-cover" 
                                onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/400x160/F0F4F8/607C9A?text=No+Image" }}
                            />
                        </div>
                        
                        <div className="p-4">
                            <div className="flex justify-between items-start mb-2">
                                <h3 className="text-xl font-bold text-gray-800">{book.title}</h3>
                                <span className={`px-3 py-1 text-xs font-semibold rounded-full ${getBadgeColor(book.type)}`}>
                                    {book.type}
                                </span>
                            </div>
                            
                            <p className="text-teal-500 font-medium mb-3">by {book.author}</p>
                            
                            <div className="text-sm space-y-1 mb-4">
                                <p><strong>Dept:</strong> {book.department}</p>
                                <p><strong>Subj:</strong> {book.subject}</p>
                                <p><strong>Year:</strong> {book.year}</p>
                                <p className="mt-2 text-lg font-extrabold text-teal-700">
                                    {priceDisplay}
                                </p>
                            </div>
                            
                            <div className="flex space-x-2 mt-4">
                                <button
                                    onClick={() => { setCurrentPage('Details'); setSelectedBookId(book.id); }}
                                    className="flex-1 bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600 transition duration-150 font-semibold shadow-md"
                                >
                                    View Details
                                </button>
                                {isOwner && (
                                    <button
                                        onClick={(e) => { e.stopPropagation(); deleteBook(book.id, book.title); }}
                                        className="bg-red-500 text-white py-2 px-3 rounded-lg hover:bg-red-600 transition duration-150 font-semibold text-sm"
                                        title="Delete Listing"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 6h6v10H7V6z" clipRule="evenodd" />
                                        </svg>
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const RegisterView = () => {
                const handleRegister = (e) => {
                    e.preventDefault();
                    setModal({ isOpen: true, title: "Demo Action", message: "Username check/registration is disabled for the local demo. Please switch to Profile to simulate sign-in." });
                };

                return (
                    <div className="max-w-md mx-auto bg-white p-8 rounded-xl shadow-2xl border-t-4 border-red-500">
                        <h2 className="text-3xl font-bold text-red-700 mb-4 text-center">Set Your Unique Username (Demo)</h2>
                        <p className="text-gray-600 mb-6 text-center">
                            This screen simulates the unique registration process for the live app.
                        </p>
                        
                        <div className="bg-gray-100 p-4 rounded-lg mb-4 text-sm">
                            Current User ID: <span className="font-mono break-all">{userId}</span>
                        </div>
                        
                        <form onSubmit={handleRegister} className="space-y-4">
                            <input
                                type="text"
                                placeholder="Choose your Unique Username (e.g., Alex_CS)"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500"
                                required
                            />
                            <button
                                type="submit"
                                className="w-full bg-red-500 text-white py-3 rounded-lg hover:bg-red-600 transition duration-150 font-bold text-lg shadow-md"
                            >
                                Simulate Registration
                            </button>
                        </form>
                    </div>
                );
            };

            const BookDetailView = () => {
                const book = books.find(b => b.id === selectedBookId);

                if (!book) {
                    return (
                        <div className="text-center p-12">
                            <h2 className="text-3xl font-bold text-red-500">Book Not Found</h2>
                            <button onClick={() => setCurrentPage('Home')} className="mt-4 text-teal-500 hover:underline">
                                Go back to Home
                            </button>
                        </div>
                    );
                }

                const isFree = book.type === 'Free';
                const priceDisplay = isFree ? 'Free' : (book.type === 'Rent' ? `₹${book.price.toFixed(0)}/Semester` : `₹${book.price.toFixed(0)}`);
                
                const isOwner = book.sellerId === userId;
                const buttonText = isFree ? 'Message Seller for Free Request' : 'Message Seller';
                

                return (
                    <div className="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-2xl border-t-4 border-teal-500">
                        <button 
                            onClick={() => { setCurrentPage('Home'); setSelectedBookId(null); }} 
                            className="mb-4 text-teal-600 hover:text-teal-800 transition duration-150 flex items-center font-semibold"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" />
                            </svg>
                            Back to Listings
                        </button>

                        <div className="grid md:grid-cols-3 gap-8">
                            <div className="md:col-span-1">
                                <div className="bg-gray-100 rounded-lg overflow-hidden border border-gray-200 shadow-md">
                                    <img 
                                        src={book.photoURL} 
                                        alt={book.title} 
                                        className="w-full h-auto object-cover" 
                                        onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/400x400/F0F4F8/607C9A?text=No+Image" }}
                                    />
                                </div>
                            </div>

                            <div className="md:col-span-2 space-y-4">
                                <div className="flex items-center justify-between">
                                    <h1 className="text-4xl font-extrabold text-gray-800">{book.title}</h1>
                                    <span className={`px-4 py-1 text-md font-semibold rounded-full ${getBadgeColor(book.type)} shadow-md`}>
                                        {book.type}
                                    </span>
                                </div>

                                <p className="text-2xl font-bold text-teal-700 mt-2">{priceDisplay}</p>
                                <p className="text-lg text-gray-600">by <span className="font-semibold">{book.author}</span></p>

                                <div className="space-y-2 border-t pt-4 mt-4">
                                    <h3 className="text-xl font-bold text-teal-700">Book Information</h3>
                                    <p><strong>Department:</strong> {book.department}</p>
                                    <p><strong>Subject:</strong> {book.subject}</p>
                                    <p><strong>Year:</strong> {book.year}</p>
                                    <p><strong>Seller:</strong> {book.sellerUsername} (ID: {book.sellerId})</p>
                                </div>
                                
                                <div className="mt-6 flex space-x-4">
                                    {!isOwner ? (
                                        <button
                                            onClick={() => initiateChatForBook(book)}
                                            className="flex-1 bg-teal-500 text-white py-3 rounded-lg hover:bg-teal-600 transition duration-150 font-bold text-lg shadow-xl disabled:bg-teal-300"
                                            disabled={!isRegistered}
                                        >
                                            {buttonText}
                                        </button>
                                    ) : (
                                        <>
                                            <span className="text-lg font-semibold text-green-600 p-3 bg-green-50 rounded-lg flex-1 text-center">
                                                This is your listing.
                                            </span>
                                            <button
                                                onClick={() => deleteBook(book.id, book.title)}
                                                className="w-1/3 bg-red-500 text-white py-3 rounded-lg hover:bg-red-600 transition duration-150 font-bold text-lg shadow-xl"
                                            >
                                                Delete Listing
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const HomeView = () => {
                const FilterBar = () => (
                    <div className="bg-teal-50 p-4 rounded-xl shadow-inner mb-6 grid grid-cols-2 md:grid-cols-5 gap-3">
                        <h2 className="text-lg font-bold text-teal-700 col-span-2 md:col-span-5 mb-2">Filter Books</h2>
                        
                        {currentPage === 'Home' && (
                            <select
                                value={filter.type}
                                onChange={(e) => setFilter({ ...filter, type: e.target.value })}
                                className="p-2 border border-teal-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                            >
                                <option value="All">All Types (Buy/Rent/Free)</option>
                                {LISTING_TYPES.map(type => <option key={type} value={type}>{type}</option>)}
                            </select>
                        )}

                        <select
                            value={filter.department}
                            onChange={(e) => setFilter({ ...filter, department: e.target.value, subject: 'All' })} 
                            className="p-2 border border-teal-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                        >
                            <option value="All">All Departments</option>
                            {DEPARTMENTS.map(dept => <option key={dept} value={dept}>{dept}</option>)}
                        </select>

                        <select
                            value={filter.subject}
                            onChange={(e) => setFilter({ ...filter, subject: e.target.value })}
                            className="p-2 border border-teal-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                        >
                            <option value="All">All Subjects</option>
                            {(filter.department !== 'All' ? DEPARTMENT_SUBJECTS[filter.department] : [])
                                .concat(filter.department === 'All' ? Object.values(DEPARTMENT_SUBJECTS).flat() : []) 
                                .filter((value, index, self) => self.indexOf(value) === index) 
                                .map(sub => <option key={sub} value={sub}>{sub}</option>)}
                        </select>

                        <select
                            value={filter.year}
                            onChange={(e) => setFilter({ ...filter, year: e.target.value })}
                            className="p-2 border border-teal-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                        >
                            <option value="All">All Years</option>
                            {YEARS.map(year => <option key={year} value={year}>{year}</option>)}
                        </select>

                        <button
                            onClick={() => setFilter({ department: 'All', subject: 'All', year: 'All', type: 'All' })}
                            className="p-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 transition duration-150 col-span-2 md:col-span-1"
                        >
                            Reset Filters
                        </button>
                    </div>
                );

                return (
                    <div className="space-y-6">
                        <h2 className="text-3xl font-bold text-teal-700 text-center">Welcome to the Scholar Hub</h2>
                        <p className="text-center text-gray-600">Browse available textbooks below or use the filters to find what you need.</p>
                        
                        <div className="grid grid-cols-3 gap-4">
                            {LISTING_TYPES.map(type => (
                                <button
                                    key={type}
                                    onClick={() => setCurrentPage(type)}
                                    className="col-span-1 p-4 bg-teal-500 text-white rounded-xl shadow-lg hover:bg-teal-600 transition duration-150 font-bold text-lg"
                                >
                                    {type} Books
                                </button>
                            ))}
                        </div>
                        
                        <FilterBar />
                        
                        <h3 className="text-2xl font-semibold text-teal-600 border-b pb-2 mb-4">All Listings ({filteredBooks.length})</h3>
                        
                        {filteredBooks.length === 0 ? (
                            <p className="text-center text-gray-500 p-8 bg-teal-50 rounded-lg">No books found matching the current criteria.</p>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                {filteredBooks.map(book => <BookCard key={book.id} book={book} />)}
                            </div>
                        )}
                    </div>
                );
            };
            
            
            const SellView = () => {
                if (!isRegistered) return <RegisterView />;
                
                const [form, setForm] = useState({ title: '', author: '', photoURL: '', department: '', subject: '', year: '', price: '', type: 'Buy' });
                const [error, setError] = useState('');
                
                const subjectsForDept = form.department ? DEPARTMENT_SUBJECTS[form.department] : [];

                const handleSubmit = (e) => {
                    e.preventDefault();
                    setError('');

                    if (!form.title || !form.author || !form.department || !form.subject || !form.year || !form.type) {
                        setError('Please fill in all required fields.');
                        return;
                    }

                    if (form.type !== 'Free' && (!form.price || isNaN(parseFloat(form.price)))) {
                        setError('Price (in Rupees) is required for Buy/Rent listings.');
                        return;
                    }
                    
                    addBook(form);
                    setForm({ title: '', author: '', photoURL: '', department: '', subject: '', year: '', price: '', type: 'Buy' });
                };

                const handleDepartmentChange = (e) => {
                    setForm({
                        ...form,
                        department: e.target.value,
                        subject: '',
                    });
                };

                return (
                    <div className="max-w-xl mx-auto bg-white p-8 rounded-xl shadow-2xl border-t-4 border-teal-500">
                        <h2 className="text-3xl font-bold text-teal-700 mb-6 text-center">List a Book for Sale, Rent, or Free</h2>
                        {error && <p className="text-red-500 bg-red-100 p-3 rounded-lg mb-4">{error}</p>}
                        
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input
                                type="text"
                                placeholder="Book Title (e.g., Introduction to Algorithms)"
                                value={form.title}
                                onChange={(e) => setForm({...form, title: e.target.value})}
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500"
                            />
                            <input
                                type="text"
                                placeholder="Author"
                                value={form.author}
                                onChange={(e) => setForm({...form, author: e.target.value})}
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500"
                            />
                            <input
                                type="url"
                                placeholder="Photo URL (Optional: Used in card view)"
                                value={form.photoURL}
                                onChange={(e) => setForm({...form, photoURL: e.target.value})}
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500"
                            />

                            <select
                                value={form.type}
                                onChange={(e) => setForm({...form, type: e.target.value, price: e.target.value === 'Free' ? '' : form.price})}
                                className="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                            >
                                <option value="">Select Listing Type</option>
                                {LISTING_TYPES.map(type => <option key={type} value={type}>{type}</option>)}
                            </select>

                            {form.type !== 'Free' && (
                                <input
                                    type="number"
                                    step="1" 
                                    placeholder={form.type === 'Rent' ? 'Rent Price in Rupees (e.g., 500)' : 'Sale Price in Rupees (e.g., 1200)'}
                                    value={form.price}
                                    onChange={(e) => setForm({...form, price: e.target.value})}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500"
                                />
                            )}

                            <div className="grid grid-cols-2 gap-4">
                                <select
                                    value={form.department}
                                    onChange={handleDepartmentChange}
                                    className="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                                >
                                    <option value="">Select Department</option>
                                    {DEPARTMENTS.map(dept => <option key={dept} value={dept}>{dept}</option>)}
                                </select>
                                <select
                                    value={form.subject}
                                    onChange={(e) => setForm({...form, subject: e.target.value})}
                                    className="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                                    disabled={!form.department}
                                >
                                    <option value="">Select Subject</option>
                                    {subjectsForDept.map(sub => <option key={sub} value={sub}>{sub}</option>)}
                                </select>
                            </div>

                            <select
                                value={form.year}
                                onChange={(e) => setForm({...form, year: e.target.value})}
                                className="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500"
                            >
                                <option value="">Select Year</option>
                                {YEARS.map(year => <option key={year} value={year}>{year}</option>)}
                            </select>

                            <button
                                type="submit"
                                className="w-full bg-teal-500 text-white py-3 rounded-lg hover:bg-teal-600 transition duration-150 font-bold text-lg shadow-md"
                            >
                                Submit Listing
                            </button>
                        </form>
                    </div>
                );
            };
            
            const MessagesView = () => {
                // Mock message view for presentation
                const MOCK_CHATS = [
                    { id: 'c1', targetName: 'CS_Senior', bookTitle: 'Introduction to Algorithms', lastMessage: 'Available for pickup tomorrow?' },
                    { id: 'c2', targetName: 'EE_Power', bookTitle: 'Linear Circuit Theory', lastMessage: 'Is the rent for one semester?' },
                ];

                return (
                    <div className="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-2xl h-[70vh] flex flex-col">
                        <h2 className="text-3xl font-bold text-teal-700 mb-4 border-b pb-2">My Messages (Demo View)</h2>
                        <p className="text-gray-500 italic mb-4">
                            This page is a mockup for the college review. In the live version, this is a real-time chat interface connecting buyers and sellers.
                        </p>
                        <div className="flex-grow overflow-y-auto space-y-3">
                            {MOCK_CHATS.map(chat => (
                                <div 
                                    key={chat.id} 
                                    className="p-4 bg-teal-50 rounded-lg cursor-pointer transition-colors border-l-4 border-teal-500 shadow-sm"
                                    onClick={() => setModal({ isOpen: true, title: "Mock Chat", message: `Simulating chat with ${chat.targetName} about "${chat.bookTitle}".` })}
                                >
                                    <div className="flex justify-between items-center">
                                        <h4 className="font-bold text-teal-700">Chat with {chat.targetName}</h4>
                                        <span className="text-xs text-gray-500">2 days ago</span>
                                    </div>
                                    <p className="text-sm text-gray-600 italic mt-1">
                                        Book: {chat.bookTitle}
                                    </p>
                                    <p className="text-xs text-gray-500 truncate">
                                        Last message: {chat.lastMessage}
                                    </p>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const ProfileView = () => {
                const myBooks = books.filter(b => b.sellerId === userId);

                const handleSimulateSignIn = () => {
                    setUserId(MOCK_USER_ID);
                    setUsername(MOCK_USERNAME);
                    setIsAuthenticated(true);
                    setIsRegistered(true);
                    setModal({ isOpen: true, title: "Demo Action", message: "Simulated successful sign-in as registered user 'DemoStudent_123'." });
                }

                return (
                    <div className="max-w-lg mx-auto bg-white p-8 rounded-xl shadow-2xl border-t-4 border-teal-500 space-y-6">
                        <h2 className="text-3xl font-bold text-teal-700 mb-4 text-center">My Student Profile (Local Demo)</h2>
                        
                        {!isRegistered && (
                            <div className="bg-red-100 p-4 rounded-xl border border-red-300">
                                <p className="text-red-700 font-bold">Registration Action Required:</p>
                                <p className="text-red-600">This is the state before a user registers.</p>
                                <button
                                    onClick={handleSimulateSignIn}
                                    className="mt-3 bg-teal-500 text-white py-2 px-4 rounded-lg hover:bg-teal-600 transition duration-150 font-semibold"
                                >
                                    Simulate Registered Login
                                </button>
                            </div>
                        )}
                        
                        <div className="bg-teal-50 p-6 rounded-xl border border-teal-200">
                            <p className="text-gray-700 font-semibold mb-2">User Status:</p>
                            <p className="text-xl font-extrabold text-teal-600">{isRegistered ? 'Registered Demo User' : 'Guest User (Simulated)'}</p>
                        </div>

                        <div className="space-y-3">
                            <p className="text-gray-700 font-semibold">User ID:</p>
                            <p className="bg-gray-100 p-3 rounded-lg font-mono text-sm break-all">{userId}</p>

                            <p className="text-gray-700 font-semibold">Public Username:</p>
                            <p className="bg-gray-100 p-3 rounded-lg font-semibold text-lg">{username}</p>
                        </div>

                        <h3 className="text-xl font-bold text-teal-700 mt-6">My Book Listings ({myBooks.length})</h3>
                        {myBooks.length === 0 ? (
                            <p className="text-gray-500 italic">You have no active listings. Go to the **Sell** page to add one!</p>
                        ) : (
                            <div className="space-y-3">
                                {myBooks.map(book => (
                                    <div key={book.id} className="bg-teal-100 p-3 rounded-lg flex justify-between items-center shadow-sm">
                                        <span className="font-medium">{book.title} ({book.type})</span>
                                        <span className="text-sm text-teal-800">{book.type === 'Free' ? 'Free' : `₹${book.price?.toFixed(0) || 'N/A'}`}</span>
                                        <button
                                            onClick={() => deleteBook(book.id, book.title)}
                                            className="bg-red-500 text-white p-1 rounded-md hover:bg-red-600 transition duration-150 font-semibold text-xs"
                                            title="Delete Listing"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                        
                        <button
                            onClick={handleSignOut}
                            className="w-full bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition duration-150 font-bold text-lg mt-8"
                        >
                            Sign Out (Demo)
                        </button>
                    </div>
                );
            };
            
            const BookTypeView = ({ type }) => (
                <div className="space-y-6">
                    <h2 className="text-4xl font-extrabold text-teal-700 text-center border-b pb-2">{type} Textbooks</h2>
                    <p className="text-center text-gray-600">
                        This section shows books listed specifically for **{type}**.
                    </p>

                    <h3 className="text-2xl font-semibold text-teal-600 border-b pb-2 mb-4">
                        {type} Listings ({filteredBooks.length})
                    </h3>
                    
                    {filteredBooks.length === 0 ? (
                        <p className="text-center text-gray-500 p-8 bg-teal-50 rounded-lg">No books found for {type} matching the current criteria.</p>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            {filteredBooks.map(book => <BookCard key={book.id} book={book} />)}
                        </div>
                    )}
                </div>
            );
            
            const renderPage = () => {
                if (!isAuthenticated && currentPage !== 'Home' && currentPage !== 'Details') {
                    return <ProfileView />; 
                }
                
                switch (currentPage) {
                    case 'Home':
                        return <HomeView />;
                    case 'Sell':
                        return <SellView />;
                    case 'Details': 
                        return <BookDetailView />;
                    case 'Buy':
                    case 'Rent':
                    case 'Free': 
                        return <BookTypeView type={currentPage} />;
                    case 'Messages':
                        return <MessagesView />;
                    case 'Profile':
                        return <ProfileView />;
                    case 'Register':
                        return <RegisterView />;
                    default:
                        return <HomeView />;
                }
            };
            
            return (
                <div className="min-h-screen bg-gray-50 font-sans">
                    <Modal
                        isOpen={modal.isOpen}
                        title={modal.title}
                        message={modal.message}
                        onClose={() => setModal({ isOpen: false, title: '', message: '' })}
                    />
                    <NavBar />
                    <main className="p-4 md:p-8 lg:p-12">
                        <div className="max-w-6xl mx-auto">
                            {renderPage()}
                        </div>
                    </main>
                    <footer className="p-4 text-center text-sm text-teal-700 bg-white border-t border-gray-200 mt-8">
                        &copy; 2024 Scholar Hub 
                    </footer>
                </div>
            );
        };

        // Render the application to the root element
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>

